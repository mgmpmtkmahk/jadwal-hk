<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Generator Jadwal Sekolah Terpadu</title>
    <link rel="icon" href="data:,">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
        :root { 
            --primary: #1e3a8a; --secondary: #2563eb; 
            --success: #059669; --warning: #d97706; --danger: #dc2626; 
            --dark: #0f172a; --bg: #e2e8f0; 
            --hdr-1: #1e40af; --hdr-2: #0f766e; --hdr-3: #5b21b6; --hdr-4: #9d174d; 
            --hdr-5: #065f46; --hdr-6: #9a3412; --hdr-7: #4338ca; --hdr-8: #b45309; --hdr-9: #111827; 
            --card-1: #eef2f9; --card-2: #fdf5e6; --card-3: #f2f9f1; --card-4: #fcf1f5; 
            --card-5: #f4f0fa; --card-6: #fff8e1; --card-7: #eef2ff; --card-8: #fff7ed; --card-9: #f8fafc;
        }
        
        body { font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; background: var(--bg); color: #1f2937; margin: 0; padding: 20px 15px; }
        .container { max-width: 98%; width: 100%; box-sizing: border-box; margin: 0 auto 120px auto; background: white; padding: 30px 40px 40px 40px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.15); position: relative;}
        
        .app-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; border-bottom: 3px solid #e2e8f0; padding-bottom: 20px; }
        .app-header img { height: 80px; width: auto; object-fit: contain; }
        .app-header .title-area { text-align: center; flex: 1; padding: 0 20px; }
        .app-header h1 { margin: 0; font-size: 28px; color: var(--dark); letter-spacing: -0.5px; line-height: 1.2; font-weight: 900;}
        .app-header p { margin: 5px 0 0 0; color: #64748b; font-weight: 600; font-size: 14px; }
        
        .global-actions { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-bottom: 35px; padding: 15px; background: #f8fafc; border-radius: 8px; border: 1px solid #cbd5e1; width: fit-content; margin-left: auto; margin-right: auto;}
        .btn-sm { height: 40px; box-sizing: border-box; padding: 0 18px; border: 2px solid transparent; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 700; background: white; transition: all 0.2s ease; display: inline-flex; align-items: center; justify-content: center; gap: 6px; color: var(--dark);}
        .btn-save { border-color: var(--primary); color: var(--primary); } .btn-save:hover { background: var(--primary); color: white; }
        .btn-load { border-color: var(--warning); color: var(--warning); } .btn-load:hover { background: var(--warning); color: white; }
        .btn-clean { border-color: var(--danger); color: var(--danger); } .btn-clean:hover { background: var(--danger); color: white; }
        .btn-file-down { border-color: #6b21a8; color: #6b21a8; } .btn-file-down:hover { background: #6b21a8; color: white; }
        .btn-file-up { border-color: var(--success); color: var(--success); margin: 0; } .btn-file-up:hover { background: var(--success); color: white; }

        .step-indicator { display: flex; justify-content: space-between; margin-bottom: 30px; padding: 0 10px; border-bottom: 2px solid #e2e8f0; padding-bottom: 15px; overflow-x: auto; gap: 15px; -ms-overflow-style: none; scrollbar-width: none; }
        .step-indicator::-webkit-scrollbar { display: none; }
        .step-pill { font-weight: 700; color: #94a3b8; font-size: 13px; position: relative; transition: 0.3s; text-transform: uppercase; letter-spacing: 0.5px; white-space: nowrap;}
        .step-pill.active { color: var(--primary); }
        .step-pill.active::after { content: ''; position: absolute; bottom: -17px; left: 0; width: 100%; height: 4px; background: var(--primary); }
        .step-pill.completed { color: var(--success); }
        
        .step-content { display: none; background: #fff; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); overflow: hidden; margin-bottom: 0; border: 1px solid #cbd5e1; }
        .step-content.active { display: block; animation: fadeInSlide 0.3s ease-out; }
        @keyframes fadeInSlide { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .step-header { padding: 18px 25px; color: white; display: flex; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.2);}
        #step1 .step-header { background: var(--hdr-1); } #step2 .step-header { background: var(--hdr-2); } #step3 .step-header { background: var(--hdr-3); } #step4 .step-header { background: var(--hdr-4); } #step5 .step-header { background: var(--hdr-5); } #step6 .step-header { background: var(--hdr-6); } #step7 .step-header { background: var(--hdr-7); } #step8 .step-header { background: var(--hdr-8); } #step9 .step-header { background: var(--hdr-9); }
        #step1 { background: var(--card-1); } #step2 { background: var(--card-2); } #step3 { background: var(--card-3); } #step4 { background: var(--card-4); } #step5 { background: var(--card-5); } #step6 { background: var(--card-6); } #step7 { background: var(--card-7); } #step8 { background: var(--card-8); } #step9 { background: var(--card-9); }
        .step-header h2 { margin: 0; font-size: 1.25rem; font-weight: 700; display: flex; align-items: center; gap: 12px; letter-spacing: 0.5px;}
        .step-icon { font-size: 1.4rem; }
        .step-body { padding: 30px 25px; }

        .form-group { margin-bottom: 15px; }
        label { display: block; font-weight: 700; margin-bottom: 8px; font-size: 14px; color: #334155;}
        input[type="number"]::-webkit-inner-spin-button, input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type="number"] { -moz-appearance: textfield; }
        input[type="text"], input[type="number"], select { width: 100%; padding: 12px 15px; box-sizing: border-box; border: 2px solid #cbd5e1; border-radius: 6px; font-size: 14px; background: rgba(255,255,255,0.9); color: #0f172a; font-weight: 500; transition: border-color 0.2s;}
        input:focus, select:focus { border-color: var(--secondary); outline: none; background: white;}
        
        .dynamic-row { display: flex; gap: 15px; align-items: center; margin-bottom: 12px; background: rgba(255,255,255,0.7); padding: 15px; border: 1px solid #cbd5e1; border-left: 4px solid var(--secondary); border-radius: 6px;}
        .dynamic-row label { width: 220px; margin: 0; color: #334155; }
        .dynamic-row input[type="text"] { flex: 1; border: 2px solid #e2e8f0;}
        .dynamic-row input[type="number"] { width: 90px !important; flex: 0 0 90px !important; text-align: center; font-weight: bold; color: var(--primary); font-size: 16px; border: 2px solid #e2e8f0;}

        .action-buttons { display: flex; gap: 15px; margin-bottom: 25px; }
        .btn-action { flex: 1; display: inline-flex; align-items: center; justify-content: center; height: 48px; box-sizing: border-box; border-radius: 6px; font-weight: 700; cursor: pointer; border: none; font-size: 14px; transition: 0.2s; text-decoration: none; gap: 10px; color: white; text-transform: uppercase; letter-spacing: 0.5px;}
        .btn-action:hover { filter: brightness(1.1); transform: translateY(-1px);}
        .btn-export { background: var(--success); } .btn-import { background: var(--warning); margin: 0;}
        .btn-generate { background: var(--primary); font-size: 16px; margin-top: 10px; height: 55px;}

        .preview-box { border-radius: 6px; overflow: hidden; background: white; border: 1px solid #cbd5e1; box-shadow: 0 2px 8px rgba(0,0,0,0.05);}
        table { width: 100%; border-collapse: collapse; font-size: 13px; white-space: nowrap; background: white;}
        th, td { border: 1px solid #cbd5e1; padding: 10px 12px; text-align: center; vertical-align: middle; }
        th { background: #f1f5f9; color: #0f172a; font-weight: 800; border-bottom: 2px solid #94a3b8; }
        tr:nth-child(even) { background-color: #f8fafc; }
        tr:hover { background-color: #e0f2fe; }
        .table-preview th { text-align: center !important; }
        .table-mapel td:first-child { text-align: left !important; font-weight: 700; color: var(--primary);}
        .table-guru td:first-child { text-align: left !important; font-weight: 700; color: var(--primary);}
        .table-guru td:nth-child(2) { text-align: left !important; color: #334155; font-weight: 500;}

        .btn-group { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 100%; max-width: 96%; box-sizing: border-box; background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(12px); padding: 15px 30px; border-radius: 16px; box-shadow: 0 8px 30px rgba(0,0,0,0.15); display: flex; justify-content: space-between; align-items: center; z-index: 9999; border: 1px solid #cbd5e1;}
        .btn-nav { height: 45px; box-sizing: border-box; padding: 0 30px; border: none; border-radius: 8px; cursor: pointer; font-weight: 700; color: white; background: var(--secondary); transition: 0.2s; font-size:14px; display: inline-flex; align-items: center; justify-content: center; gap: 8px; text-transform: uppercase;}
        .btn-nav:hover { background: #3b82f6; transform: translateY(-2px);}
        .btn-prev { background: #64748b; } .btn-prev:hover { background: #475569; }
        
        .tabs { display: flex; gap: 4px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 5px;}
        .tab-btn { height: 45px; padding: 0 25px; background: #e2e8f0; border: 1px solid #cbd5e1; border-bottom: none; font-weight: 700; cursor: pointer; border-radius: 6px 6px 0 0; color: #475569; transition: 0.2s; white-space: nowrap; display: flex; align-items: center; gap: 8px;}
        .tab-btn:hover { background: #f1f5f9; color: var(--dark);}
        .tab-btn.active { background: var(--dark); color: white; border-color: var(--dark); }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s; }
        .badge { background: var(--danger); color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 800;}

        .validator-box { background: #fef2f2; border-left: 5px solid var(--danger); padding: 20px; border-radius: 6px; border: 1px solid #fca5a5; }
        .validator-box h3 { margin-top: 0; color: var(--danger); display: flex; align-items: center; gap: 10px; }
        .validator-table th { background: var(--danger); color: white; border-color: #b91c1c;}
        .validator-table td { text-align: left !important; white-space: normal; border-color: #fca5a5; color: #7f1d1d;}

        .jadwal-wrapper { margin-bottom: 30px; background: #fff; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.08); overflow: hidden; border: 1px solid #cbd5e1;}
        .jadwal-wrapper h3 { margin: 0; padding: 15px 20px; background: var(--primary); color: white; font-size: 16px; display: flex; align-items: center; gap: 10px;}
        .guru-wrapper h3 { background: var(--secondary); }
        .cell-jadwal { font-size: 13px; line-height: 1.4; padding: 8px !important;}
        .cell-kosong { background: #fee2e2; color: var(--danger); font-weight: bold;}
        .cell-tahfidz { background: #ecfdf5; color: #047857; }
        .mapel-name { font-weight: 800; display: block; color: var(--dark); margin-bottom: 2px;}
        .guru-name { color: #64748b; font-style: italic; font-size: 11px; font-weight: 600;}

        .stat-box { display: inline-flex; align-items: center; gap: 10px; padding: 10px 20px; background: var(--dark); color: white; border-radius: 6px; margin-bottom: 20px; font-weight: 700; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .stat-angka { font-size: 24px; color: #facc15; }

        .print-page { width: 100%; overflow-x: auto; margin-bottom: 25px; background: white; padding: 20px; border-radius: 8px; border: 1px solid #cbd5e1;}
        .print-page h2 { text-align:center; color: var(--dark); margin-bottom: 20px; font-size: 18px; font-weight: 900; text-transform: uppercase;}
        .compact-table { width: 100%; border-collapse: collapse; font-size: 12px; margin-bottom: 15px; border: 2px solid #94a3b8;}
        .compact-table th, .compact-table td { border: 1px solid #cbd5e1; padding: 6px 8px; text-align: center; color: #0f172a;}
        .compact-table th { background: #e2e8f0; color: #0f172a; border-bottom: 2px solid #94a3b8; font-weight: 800;}
        .compact-table-all { width: 100%; border-collapse: collapse; font-size: 10.5px; margin-bottom: 15px; border: 2px solid #94a3b8;}
        .compact-table-all th, .compact-table-all td { border: 1px solid #cbd5e1; padding: 4px 5px; text-align: center; color: #0f172a; word-wrap: break-word;}
        .compact-table-all th { background: #e2e8f0; color: #0f172a; border-bottom: 2px solid #94a3b8; font-weight: 800;}
        .legend-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 10px; font-size: 12px; margin-top: 15px; border: 2px solid #e2e8f0; padding: 15px; background: #f8fafc; border-radius: 6px;}
        .legend-item b { color: white; background: var(--dark); padding: 2px 6px; border-radius: 4px; margin-right: 5px; font-family: monospace; font-size: 13px;}
        
        @media screen {
            .page-break { border-bottom: 2px dashed #94a3b8; margin: 40px 0; text-align: center; position: relative; opacity: 0.5; }
            .page-break::after { content: '‚úÇÔ∏è Pemisah Halaman Cetak'; position: absolute; top: -12px; background: var(--bg); padding: 0 15px; color: #777; font-size: 12px; left: 50%; transform: translateX(-50%); font-weight: bold;}
        }
        @media print {
            @page { size: landscape; margin: 10mm; }
            body { padding: 0; background: white; }
            .container { box-shadow: none; padding: 0; margin: 0; max-width: 100%; width: 100%; border: none;}
            .app-header, .global-actions, .step-indicator, .btn-group, .action-buttons, #filterArea, .tabs, button, .stat-box { display: none !important; }
            .step-content { display: none; padding: 0; box-shadow: none; border: none; margin: 0;}
            .step-body { padding: 0; } .step-header { display: none; }
            #step9 { display: block !important; }
            .tab-content { display: none !important; } 
            .tab-content.active { display: block !important; } 
            .compact-table th, .compact-table-all th { background: #e0e0e0 !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; color: #000; border: 1px solid #000;}
            .compact-table td, .compact-table-all td { border: 1px solid #000; color: #000; }
            .legend-container { background: white !important; border: 1px solid #000; }
            .legend-item b { color: #000 !important; background: #ddd !important; }
            .print-page { box-shadow: none; padding: 0; margin-bottom: 0; border-radius: 0; border: none;}
            .jadwal-wrapper { page-break-after: always; page-break-inside: avoid; box-shadow: none; border: none; padding: 0; margin: 0;}
            .jadwal-wrapper:last-of-type { page-break-after: auto; } 
            .jadwal-wrapper h3 { border: none; padding: 0 0 10px 0; color: #000; background: white; }
            .jadwal-wrapper table { border: 1px solid #000; width: 100%; }
            .jadwal-wrapper th, .jadwal-wrapper td { border: 1px solid #000; color: #000; }
            .cell-kosong, .cell-tahfidz { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .page-break { page-break-after: always; border: none; margin: 0; }
            .page-break::after { content: none; }
            #tab-analisis { display: none !important; }
        }

        #toast-container { position: fixed; bottom: 35px; left: 50%; transform: translateX(-50%); z-index: 10000; display: flex; flex-direction: column; gap: 10px; align-items: center; pointer-events: none; }
        .toast { padding: 12px 25px; border-radius: 50px; color: white; box-shadow: 0 10px 30px rgba(0,0,0,0.2); font-weight: 700; font-size: 14px; animation: slideUpToast 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; opacity: 0; transform: translateY(50px); display: flex; align-items: center; gap: 10px; pointer-events: auto; }
        .toast.success { background: linear-gradient(to right, #2ecc71, #27ae60); } 
        .toast.error { background: linear-gradient(to right, #e74c3c, #c0392b); } 
        .toast.warning { background: linear-gradient(to right, #f1c40f, #f39c12); }
        .toast.fade-out { opacity: 0; transform: translateY(50px) scale(0.9); transition: 0.3s; }
        @keyframes slideUpToast { to { opacity: 1; transform: translateY(0); } }

        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(4px); display: flex; justify-content: center; align-items: center; z-index: 10000; opacity: 0; visibility: hidden; transition: 0.2s;}
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-box { background: white; padding: 30px; border-radius: 12px; width: 400px; max-width: 90%; text-align: center; box-shadow: 0 20px 40px rgba(0,0,0,0.3); transform: scale(0.9); transition: 0.2s; }
        .modal-overlay.active .modal-box { transform: scale(1); }
        .modal-buttons { display: flex; justify-content: center; gap: 10px; margin-top: 25px;}
        .modal-buttons button { height: 45px; padding: 0 25px; border: none; border-radius: 6px; cursor: pointer; font-weight: 700; font-size: 14px; transition: 0.2s; flex: 1;}
        .btn-yes { background: var(--danger); color: white; } .btn-yes:hover { background: #b91c1c; }
        .btn-no { background: #e2e8f0; color: #475569; } .btn-no:hover { background: #cbd5e1; color: #0f172a;}

        /* ANIMASI LOADING */
        .loading-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.9); z-index: 10000; display: flex; flex-direction: column; justify-content: center; align-items: center; visibility: hidden; opacity: 0; transition: 0.3s; }
        .loading-overlay.active { visibility: visible; opacity: 1; }
        .spinner { width: 50px; height: 50px; border: 5px solid #cbd5e1; border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px;}
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text { font-size: 18px; font-weight: 800; color: var(--primary); letter-spacing: 1px;}
    </style>
</head>
<body>

<div class="container">
    
    <div class="app-header">
        <img src="logo2.png" alt="Logo Kiri">
        <div class="title-area">
            <h1>SISTEM PENJADWALAN SEKOLAH TERPADU</h1>
            <p>Generator Jadwal KBM & Ujian Otomatis (Monte Carlo A.I)</p>
        </div>
        <img src="logo1.png" alt="Logo Kanan">
    </div>
    
    <div class="global-actions">
        <button class="btn-sm btn-save" onclick="saveDraft()" title="Simpan ke memori lokal browser">üíæ Save</button>
        <button class="btn-sm btn-load" onclick="loadDraft()" title="Muat dari memori lokal browser">üìÇ Load</button>
        <button class="btn-sm btn-clean" onclick="cleanDraft()" title="Hapus semua tabel & input">üóëÔ∏è Reset</button>
        <button class="btn-sm btn-file-down" onclick="downloadProgressFile()" title="Unduh File Backup JSON">‚¨áÔ∏è Backup</button>
        <label class="btn-sm btn-file-up" style="cursor: pointer;" title="Unggah File Backup JSON">
            ‚¨ÜÔ∏è Restore
            <input type="file" accept=".json" style="display:none;" onchange="uploadProgressFile(event)">
        </label>
    </div>

    <div class="step-indicator" id="stepIndicator"></div>

    <div id="step1" class="step-content active">
        <div class="step-header"><h2><span class="step-icon">üè´</span> LANGKAH 1: INPUT TINGKAT KELAS</h2></div>
        <div class="step-body">
            <div class="form-group">
                <label>Masukkan Daftar Tingkat Kelas (Pisahkan dengan koma):</label>
                <input type="text" id="inputTingkat" placeholder="Contoh: X, XI, XII">
            </div>
        </div>
    </div>

    <div id="step2" class="step-content">
        <div class="step-header"><h2><span class="step-icon">üîÄ</span> LANGKAH 2: RINCIAN JURUSAN</h2></div>
        <div class="step-body">
            <p style="margin-bottom: 20px; color: #64748b;">Tuliskan jurusan untuk setiap tingkat. Jika tidak ada jurusan, ketik "Tidak Ada".</p>
            <div id="formJurusanArea"></div>
        </div>
    </div>

    <div id="step3" class="step-content">
        <div class="step-header"><h2><span class="step-icon">üî¢</span> LANGKAH 3: KELAS PARALEL</h2></div>
        <div class="step-body">
            <p style="margin-bottom: 20px; color: #64748b;">Tentukan total jumlah rombel untuk masing-masing kelompok kelas.</p>
            <div id="formParalelArea"></div>
        </div>
    </div>

    <div id="step4" class="step-content">
        <div class="step-header"><h2><span class="step-icon">üöª</span> LANGKAH 4: SPLIT GENDER</h2></div>
        <div class="step-body">
            <p style="margin-bottom: 20px; color: #64748b;">Pecah total kelas paralel menjadi jumlah kelas Putra (PA) dan Putri (PI).</p>
            <div id="formSplitArea"></div>
        </div>
    </div>

    <div id="step5" class="step-content">
        <div class="step-header"><h2><span class="step-icon">üìö</span> LANGKAH 5: MATRIKS MATA PELAJARAN</h2></div>
        <div class="step-body">
            <p style="margin-bottom: 25px; color: #64748b; line-height: 1.5;">Unduh template, isi daftar mapel dan Jam Pelajaran (JP) per minggu, lalu upload kembali.</p>
            <div class="action-buttons">
                <button class="btn-action btn-export" onclick="exportTemplateMapel()">üì• DOWNLOAD TEMPLATE MAPEL</button>
                <label class="btn-action btn-import">
                    üì§ UPLOAD DATA MAPEL
                    <input type="file" id="importMapel" accept=".csv, .xls, .xlsx" style="display: none;" onchange="importDataMapel(event)">
                </label>
            </div>
            <div class="preview-box" id="previewMapel"></div>
        </div>
    </div>

    <div id="step6" class="step-content">
        <div class="step-header"><h2><span class="step-icon">üë®‚Äçüè´</span> LANGKAH 6: MATRIKS GURU</h2></div>
        <div class="step-body">
            <p style="margin-bottom: 15px; color: #64748b;">Upload daftar guru. Anda dapat mengedit jumlah JP langsung di dalam tabel, atau gunakan tombol Auto-Distribusi agar sistem menghitungnya untuk Anda.</p>
            <div class="action-buttons">
                <button class="btn-action btn-export" onclick="exportTemplateGuru()">üì• DOWNLOAD TEMPLATE</button>
                <label class="btn-action btn-import">
                    üì§ UPLOAD DATA GURU
                    <input type="file" id="importGuru" accept=".csv, .xls, .xlsx" style="display: none;" onchange="importDataGuru(event)">
                </label>
                <button class="btn-action" style="background: var(--secondary); margin: 0; box-shadow: 0 4px 10px rgba(37,99,235,0.3);" onclick="autoDistribusiGuru()">ü™Ñ AUTO-DISTRIBUSI JP</button>
            </div>
            <div class="preview-box" id="previewGuru"></div>
        </div>
    </div>

    <div id="step7" class="step-content">
        <div class="step-header"><h2><span class="step-icon">‚õî</span> LANGKAH 7: BATASAN WAKTU GURU</h2></div>
        <div class="step-body">
            <p style="margin-bottom: 15px; color: #64748b;">Tentukan hari dan Jam Ke- berapa guru <b>TIDAK BISA</b> mengajar/mengawas. Kosongkan isian "Jam Ke-" jika guru izin/libur seharian pada hari tersebut.</p>
            
            <div class="dynamic-row" style="background: white; align-items: flex-end;">
                <div style="flex: 2;">
                    <label>Nama Guru:</label>
                    <select id="restrictGuru">
                        <option value="">-- Pilih Guru Dulu --</option>
                    </select>
                </div>
                <div style="flex: 1;">
                    <label>Hari Terbatas:</label>
                    <select id="restrictHari">
                        <option value="Senin">Senin</option>
                        <option value="Selasa">Selasa</option>
                        <option value="Rabu">Rabu</option>
                        <option value="Kamis">Kamis</option>
                        <option value="Jumat">Jumat</option>
                        <option value="Sabtu">Sabtu</option>
                    </select>
                </div>
                <div style="flex: 1.5;">
                    <label>Jam Ke- (Bisa banyak):</label>
                    <input type="text" id="restrictJam" placeholder="Contoh: 1, 2, 8, 9">
                </div>
                <div>
                    <button class="btn-action btn-import" style="height: 44px; margin-bottom: 2px; padding: 0 15px;" onclick="tambahBatasan()">‚ûï TAMBAH</button>
                </div>
            </div>
            
            <div class="preview-box" style="margin-top: 20px;">
                <table id="tabelBatasan">
                    <thead>
                        <tr>
                            <th style="text-align:center;">Nama Guru</th>
                            <th style="text-align:center;">Hari Izin / Libur</th>
                            <th style="text-align:center;">Sesi / Jam Ke-</th>
                            <th style="text-align:center; width: 100px;">Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="bodyBatasan">
                        <tr><td colspan="4" style="color: #94a3b8; text-align:center;">Belum ada batasan waktu yang ditambahkan.</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="step8" class="step-content">
        <div class="step-header"><h2><span class="step-icon">‚öôÔ∏è</span> LANGKAH 8: SETUP JADWAL</h2></div>
        <div class="step-body">
            <div style="background: white; padding: 25px; border-radius: 8px; border: 1px solid #cbd5e1;">
                <div class="dynamic-row" style="background: #f8fafc; border-left-color: var(--primary);">
                    <label style="font-weight:800;">PILIH MODE JADWAL:</label>
                    <select id="modeJadwal" onchange="toggleModeSettings()" style="width: auto; flex:1; font-size: 15px; font-weight:700;">
                        <option value="KBM">üìÖ Jadwal Pelajaran Reguler (KBM)</option>
                        <option value="PTS">üìù Jadwal Ujian PTS (Per Kelas)</option>
                        <option value="PAS">üèõÔ∏è Jadwal Ujian PAS / PAT (Ruang Merger)</option>
                    </select>
                </div>
                <div id="customModeSettings" class="dynamic-row" style="background: #f8fafc; border-left-color: var(--warning); margin-top: 15px;">
                    <label id="labelSettingWaktu" style="font-weight:800;">SETTING WAKTU KBM:</label> 
                    <div style="display: flex; align-items: center; gap: 10px; flex: 1;">
                        <span style="font-weight:600; font-size:14px;">Total Hari:</span> <input type="number" id="jmlHariUjian" value="6" style="width: 80px;">
                        <span style="font-weight:600; font-size:14px; margin-left:15px;">Sesi/Hari:</span> <input type="number" id="jmlJPUjian" value="9" style="width: 80px;">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="step9" class="step-content">
        <div class="step-header">
            <h2><span class="step-icon">üìÑ</span> LANGKAH 9: HASIL & EXPORT</h2>
        </div>
        <div class="step-body">
            <button class="btn-action btn-generate" style="width: 100%; color: white; margin-bottom: 25px; background: linear-gradient(to right, var(--primary), var(--secondary)); box-shadow: 0 4px 15px rgba(37, 99, 235, 0.4);" onclick="jalankanMonteCarlo()">üöÄ GENERATE / ACAK ULANG JADWAL</button>
            
            <div id="finalOutputArea">
                <div style="text-align: center; padding: 40px; color: #94a3b8;">
                    <span style="font-size: 50px; display: block; margin-bottom: 20px;">üé≤</span>
                    <b>Klik tombol "Generate" di atas untuk memutar mesin A.I.</b><br>Anda bisa mengkliknya berkali-kali untuk mencari formasi jadwal yang paling ideal.
                </div>
            </div>
        </div>
    </div>
</div>

<div class="btn-group">
    <button id="btnPrev" class="btn-nav btn-prev" onclick="prevStep()" style="display: none;">‚¨ÖÔ∏è KEMBALI</button>
    <button id="btnNext" class="btn-nav" onclick="nextStep()">LANJUT BERIKUTNYA ‚û°Ô∏è</button>
</div>

<div id="toast-container"></div>
<div class="modal-overlay" id="customConfirmModal">
    <div class="modal-box">
        <div style="font-size:50px; margin-bottom: 10px;">‚ö†Ô∏è</div>
        <h3 style="margin: 0 0 10px 0; color: #0f172a; font-weight:800;">KONFIRMASI</h3>
        <div id="confirmMessage" style="font-size: 15px; color: #475569; margin-bottom: 25px; line-height:1.5;"></div>
        <div class="modal-buttons">
            <button class="btn-no" onclick="closeConfirmModal()">BATAL</button>
            <button class="btn-yes" id="btnConfirmYes">YA, LANJUTKAN</button>
        </div>
    </div>
</div>

<div class="loading-overlay" id="loadingOverlay">
    <div class="spinner"></div>
    <div class="loading-text">Mencari Kombinasi Terbaik...</div>
</div>

<script src="script.js"></script>

</body>
</html>